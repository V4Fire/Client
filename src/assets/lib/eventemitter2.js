!function(undefined){function init(){this._events={},this._conf&&configure.call(this,this._conf)}function configure(conf){conf&&(this._conf=conf,conf.delimiter&&(this.delimiter=conf.delimiter),conf.maxListeners!==undefined&&(this._maxListeners=conf.maxListeners),conf.wildcard&&(this.wildcard=conf.wildcard),conf.newListener&&(this._newListener=conf.newListener),conf.removeListener&&(this._removeListener=conf.removeListener),conf.verboseMemoryLeak&&(this.verboseMemoryLeak=conf.verboseMemoryLeak),conf.ignoreErrors&&(this.ignoreErrors=conf.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function logPossibleMemoryLeak(count,eventName){var errorMsg="(node) warning: possible EventEmitter memory leak detected. "+count+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(errorMsg+=" Event name: "+eventName+"."),"undefined"!=typeof process&&process.emitWarning){var e=new Error(errorMsg);e.name="MaxListenersExceededWarning",e.emitter=this,e.count=count,process.emitWarning(e)}else console.error(errorMsg),console.trace&&console.trace()}function toObject(keys,values){for(var key,obj={},len=keys.length,valuesCount=values?values.length:0,i=0;i<len;i++)key=keys[i],obj[key]=i<valuesCount?values[i]:undefined;return obj}function TargetObserver(emitter,target,options){this._emitter=emitter,this._target=target,this._listeners={},this._listenersCount=0;var on,off;if((options.on||options.off)&&(on=options.on,off=options.off),target.addEventListener?(on=target.addEventListener,off=target.removeEventListener):target.addListener?(on=target.addListener,off=target.removeListener):target.on&&(on=target.on,off=target.off),!on&&!off)throw Error("target does not implement any known event API");if("function"!=typeof on)throw TypeError("on method must be a function");if("function"!=typeof off)throw TypeError("off method must be a function");this._on=on,this._off=off;var _observers=emitter._observers;_observers?_observers.push(this):emitter._observers=[this]}function resolveOptions(options,schema,reducers,allowUnknown){function reject(reason){throw Error('Invalid "'+option+'" option value'+(reason?". Reason: "+reason:""))}var computedOptions=Object.assign({},schema);if(!options)return computedOptions;if("object"!=typeof options)throw TypeError("options must be an object");for(var option,value,reducer,keys=Object.keys(options),length=keys.length,i=0;i<length;i++){if(option=keys[i],!allowUnknown&&!hasOwnProperty.call(schema,option))throw Error('Unknown "'+option+'" option');(value=options[option])!==undefined&&(reducer=reducers[option],computedOptions[option]=reducer?reducer(value,reject):value)}return computedOptions}function constructorReducer(value,reject){return"function"==typeof value&&value.hasOwnProperty("prototype")||reject("value must be a constructor"),value}function makeTypeReducer(types){var message="value must be type of "+types.join("|"),len=types.length,firstType=types[0],secondType=types[1];return 1===len?function(v,reject){if(typeof v===firstType)return v;reject(message)}:2===len?function(v,reject){var kind=typeof v;if(kind===firstType||kind===secondType)return v;reject(message)}:function(v,reject){for(var kind=typeof v,i=len;i-- >0;)if(kind===types[i])return v;reject(message)}}function makeCancelablePromise(Promise,executor,options){var isCancelable,callbacks,subscriptionClosed,timer=0,promise=new Promise(function(resolve,reject,onCancel){function cleanup(){callbacks&&(callbacks=null),timer&&(clearTimeout(timer),timer=0)}options=resolveOptions(options,{timeout:0,overload:!1},{timeout:function(value,reject){return value*=1,("number"!=typeof value||value<0||!Number.isFinite(value))&&reject("timeout must be a positive number"),value}}),isCancelable=!options.overload&&"function"==typeof Promise.prototype.cancel&&"function"==typeof onCancel;var _resolve=function(value){cleanup(),resolve(value)},_reject=function(err){cleanup(),reject(err)};isCancelable?executor(_resolve,_reject,onCancel):(callbacks=[function(reason){_reject(reason||Error("canceled"))}],executor(_resolve,_reject,function(cb){if(subscriptionClosed)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!=typeof cb)throw TypeError("onCancel callback must be a function");callbacks.push(cb)}),subscriptionClosed=!0),options.timeout>0&&(timer=setTimeout(function(){var reason=Error("timeout");reason.code="ETIMEDOUT",timer=0,promise.cancel(reason),reject(reason)},options.timeout))});return isCancelable||(promise.cancel=function(reason){if(callbacks){for(var length=callbacks.length,i=1;i<length;i++)callbacks[i](reason);callbacks[0](reason),callbacks=null}}),promise}function findTargetIndex(observer){var observers=this._observers;if(!observers)return-1;for(var len=observers.length,i=0;i<len;i++)if(observers[i]._target===observer)return i;return-1}function searchListenerTree(handlers,type,tree,i,typeLength){if(!tree)return null;if(0===i){var kind=typeof type;if("string"===kind){var ns,n,l=0,j=0,delimiter=this.delimiter,dl=delimiter.length;if(-1!==(n=type.indexOf(delimiter))){ns=new Array(5);do{ns[l++]=type.slice(j,n),j=n+dl}while(-1!==(n=type.indexOf(delimiter,j)));ns[l++]=type.slice(j),type=ns,typeLength=l}else type=[type],typeLength=1}else"object"===kind?typeLength=type.length:(type=[type],typeLength=1)}var branch,xTree,xxTree,isolatedBranch,endReached,branches,_listeners,listeners=null,currentType=type[i],nextType=type[i+1];if(i===typeLength)tree._listeners&&("function"==typeof tree._listeners?(handlers&&handlers.push(tree._listeners),listeners=[tree]):(handlers&&handlers.push.apply(handlers,tree._listeners),listeners=[tree]));else{if("*"===currentType){for(branches=ownKeys(tree),n=branches.length;n-- >0;)"_listeners"!==(branch=branches[n])&&(_listeners=searchListenerTree(handlers,type,tree[branch],i+1,typeLength))&&(listeners?listeners.push.apply(listeners,_listeners):listeners=_listeners);return listeners}if("**"===currentType){for(endReached=i+1===typeLength||i+2===typeLength&&"*"===nextType,endReached&&tree._listeners&&(listeners=searchListenerTree(handlers,type,tree,typeLength,typeLength)),branches=ownKeys(tree),n=branches.length;n-- >0;)"_listeners"!==(branch=branches[n])&&("*"===branch||"**"===branch?(tree[branch]._listeners&&!endReached&&(_listeners=searchListenerTree(handlers,type,tree[branch],typeLength,typeLength))&&(listeners?listeners.push.apply(listeners,_listeners):listeners=_listeners),_listeners=searchListenerTree(handlers,type,tree[branch],i,typeLength)):_listeners=branch===nextType?searchListenerTree(handlers,type,tree[branch],i+2,typeLength):searchListenerTree(handlers,type,tree[branch],i,typeLength),_listeners&&(listeners?listeners.push.apply(listeners,_listeners):listeners=_listeners));return listeners}tree[currentType]&&(listeners=searchListenerTree(handlers,type,tree[currentType],i+1,typeLength))}if(xTree=tree["*"],xTree&&searchListenerTree(handlers,type,xTree,i+1,typeLength),xxTree=tree["**"])if(i<typeLength)for(xxTree._listeners&&searchListenerTree(handlers,type,xxTree,typeLength,typeLength),branches=ownKeys(xxTree),n=branches.length;n-- >0;)"_listeners"!==(branch=branches[n])&&(branch===nextType?searchListenerTree(handlers,type,xxTree[branch],i+2,typeLength):branch===currentType?searchListenerTree(handlers,type,xxTree[branch],i+1,typeLength):(isolatedBranch={},isolatedBranch[branch]=xxTree[branch],searchListenerTree(handlers,type,{"**":isolatedBranch},i+1,typeLength)));else xxTree._listeners?searchListenerTree(handlers,type,xxTree,typeLength,typeLength):xxTree["*"]&&xxTree["*"]._listeners&&searchListenerTree(handlers,type,xxTree["*"],typeLength,typeLength);return listeners}function growListenerTree(type,listener,prepend){var i,ns,len=0,j=0,delimiter=this.delimiter,dl=delimiter.length;if("string"==typeof type)if(-1!==(i=type.indexOf(delimiter))){ns=new Array(5);do{ns[len++]=type.slice(j,i),j=i+dl}while(-1!==(i=type.indexOf(delimiter,j)));ns[len++]=type.slice(j)}else ns=[type],len=1;else ns=type,len=type.length;if(len>1)for(i=0;i+1<len;i++)if("**"===ns[i]&&"**"===ns[i+1])return;var name,tree=this.listenerTree;for(i=0;i<len;i++)if(name=ns[i],tree=tree[name]||(tree[name]={}),i===len-1)return tree._listeners?("function"==typeof tree._listeners&&(tree._listeners=[tree._listeners]),prepend?tree._listeners.unshift(listener):tree._listeners.push(listener),!tree._listeners.warned&&this._maxListeners>0&&tree._listeners.length>this._maxListeners&&(tree._listeners.warned=!0,logPossibleMemoryLeak.call(this,tree._listeners.length,name))):tree._listeners=listener,!0;return!0}function collectTreeEvents(tree,events,root,asArray){for(var branch,branchName,path,isArrayPath,branches=ownKeys(tree),i=branches.length,hasListeners=tree._listeners;i-- >0;)branchName=branches[i],branch=tree[branchName],path="_listeners"===branchName?root:root?root.concat(branchName):[branchName],isArrayPath=asArray||"symbol"==typeof branchName,hasListeners&&events.push(isArrayPath?path:path.join(this.delimiter)),"object"==typeof branch&&collectTreeEvents.call(this,branch,events,path,isArrayPath);return events}function recursivelyGarbageCollect(root){for(var obj,key,flag,keys=ownKeys(root),i=keys.length;i-- >0;)key=keys[i],(obj=root[key])&&(flag=!0,"_listeners"===key||recursivelyGarbageCollect(obj)||delete root[key]);return flag}function Listener(emitter,event,listener){this.emitter=emitter,this.event=event,this.listener=listener}function setupListener(event,listener,options){if(!0===options)promisify=!0;else if(!1===options)async=!0;else{if(!options||"object"!=typeof options)throw TypeError("options should be an object or true");var async=options.async,promisify=options.promisify,nextTick=options.nextTick,objectify=options.objectify}if(async||nextTick||promisify){var _listener=listener,_origin=listener._origin||listener;if(nextTick&&!nextTickSupported)throw Error("process.nextTick is not supported");promisify===undefined&&(promisify="AsyncFunction"===listener.constructor.name),listener=function(){var args=arguments,context=this,event=this.event;return promisify?nextTick?Promise.resolve():new Promise(function(resolve){_setImmediate(resolve)}).then(function(){return context.event=event,_listener.apply(context,args)}):(nextTick?process.nextTick:_setImmediate)(function(){context.event=event,_listener.apply(context,args)})},listener._async=!0,listener._origin=_origin}return[listener,objectify?new Listener(this,event,listener):this]}function EventEmitter(conf){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,configure.call(this,conf)}function once(emitter,name,options){return options=resolveOptions(options,{Promise:Promise,timeout:0,overload:!1},{Promise:constructorReducer}),makeCancelablePromise(options.Promise,function(resolve,reject,onCancel){var handler;if("function"==typeof emitter.addEventListener)return handler=function(){resolve(toArray.apply(null,arguments))},onCancel(function(){emitter.removeEventListener(name,handler)}),void emitter.addEventListener(name,handler,{once:!0});var errorListener,eventListener=function(){errorListener&&emitter.removeListener("error",errorListener),resolve(toArray.apply(null,arguments))};"error"!==name&&(errorListener=function(err){emitter.removeListener(name,eventListener),reject(err)},emitter.once("error",errorListener)),onCancel(function(){errorListener&&emitter.removeListener("error",errorListener),emitter.removeListener(name,eventListener)}),emitter.once(name,eventListener)},{timeout:options.timeout,overload:options.overload})}function isGlobal(obj){return Boolean(obj)&&obj.Math===Math}var hasOwnProperty=Object.hasOwnProperty,isArray=Array.isArray?Array.isArray:function _isArray(obj){return"[object Array]"===Object.prototype.toString.call(obj)},nextTickSupported="object"==typeof process&&"function"==typeof process.nextTick,symbolsSupported="function"==typeof Symbol,reflectSupported="object"==typeof Reflect,setImmediateSupported="function"==typeof setImmediate,_setImmediate=setImmediateSupported?setImmediate:setTimeout,ownKeys=symbolsSupported?reflectSupported&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:function(obj){var arr=Object.getOwnPropertyNames(obj);return arr.push.apply(arr,Object.getOwnPropertySymbols(obj)),arr}:Object.keys,toArray=function(a,b,c){var n=arguments.length;switch(n){case 0:return[];case 1:return[a];case 2:return[a,b];case 3:return[a,b,c];default:for(var arr=new Array(n);n--;)arr[n]=arguments[n];return arr}};Object.assign(TargetObserver.prototype,{subscribe:function(event,localEvent,reducer){var observer=this,target=this._target,emitter=this._emitter,listeners=this._listeners,handler=function(){var args=toArray.apply(null,arguments),eventObj={data:args,name:localEvent,original:event};if(reducer)return void(!1!==reducer.call(target,eventObj)&&emitter.emit.apply(emitter,[eventObj.name].concat(args)));emitter.emit.apply(emitter,[localEvent].concat(args))};if(listeners[event])throw Error("Event '"+event+"' is already listening");this._listenersCount++,emitter._newListener&&emitter._removeListener&&!observer._onNewListener?(this._onNewListener=function(_event){_event===localEvent&&null===listeners[event]&&(listeners[event]=handler,observer._on.call(target,event,handler))},emitter.on("newListener",this._onNewListener),this._onRemoveListener=function(_event){_event===localEvent&&!emitter.hasListeners(_event)&&listeners[event]&&(listeners[event]=null,observer._off.call(target,event,handler))},listeners[event]=null,emitter.on("removeListener",this._onRemoveListener)):(listeners[event]=handler,observer._on.call(target,event,handler))},unsubscribe:function(event){function clearRefs(){observer._onNewListener&&(emitter.off("newListener",observer._onNewListener),emitter.off("removeListener",observer._onRemoveListener),observer._onNewListener=null,observer._onRemoveListener=null);var index=findTargetIndex.call(emitter,observer);emitter._observers.splice(index,1)}var handler,events,i,observer=this,listeners=this._listeners,emitter=this._emitter,off=this._off,target=this._target;if(event&&"string"!=typeof event)throw TypeError("event must be a string");if(event){if(!(handler=listeners[event]))return;off.call(target,event,handler),delete listeners[event],--this._listenersCount||clearRefs()}else{for(events=ownKeys(listeners),i=events.length;i-- >0;)event=events[i],off.call(target,event,listeners[event]);this._listeners={},this._listenersCount=0,clearRefs()}}});var functionReducer=makeTypeReducer(["function"]),objectFunctionReducer=makeTypeReducer(["object","function"]);Listener.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},EventEmitter.EventEmitter2=EventEmitter,EventEmitter.prototype.listenTo=function(target,events,options){if("object"!=typeof target)throw TypeError("target musts be an object");var emitter=this;return options=resolveOptions(options,{on:undefined,off:undefined,reducers:undefined},{on:functionReducer,off:functionReducer,reducers:objectFunctionReducer}),function listen(events){if("object"!=typeof events)throw TypeError("events must be an object");var observer,reducers=options.reducers,index=findTargetIndex.call(emitter,target);observer=-1===index?new TargetObserver(emitter,target,options):emitter._observers[index];for(var event,keys=ownKeys(events),len=keys.length,isSingleReducer="function"==typeof reducers,i=0;i<len;i++)event=keys[i],observer.subscribe(event,events[event]||event,isSingleReducer?reducers:reducers&&reducers[event])}(isArray(events)?toObject(events):"string"==typeof events?toObject(events.split(/\s+/)):events),this},EventEmitter.prototype.stopListeningTo=function(target,event){var observers=this._observers;if(!observers)return!1;var observer,i=observers.length,matched=!1;if(target&&"object"!=typeof target)throw TypeError("target should be an object");for(;i-- >0;)observer=observers[i],target&&observer._target!==target||(observer.unsubscribe(event),matched=!0);return matched},EventEmitter.prototype.delimiter=".",EventEmitter.prototype.setMaxListeners=function(n){n!==undefined&&(this._maxListeners=n,this._conf||(this._conf={}),this._conf.maxListeners=n)},EventEmitter.prototype.getMaxListeners=function(){return this._maxListeners},EventEmitter.prototype.event="",EventEmitter.prototype.once=function(event,fn,options){return this._once(event,fn,!1,options)},EventEmitter.prototype.prependOnceListener=function(event,fn,options){return this._once(event,fn,!0,options)},EventEmitter.prototype._once=function(event,fn,prepend,options){return this._many(event,1,fn,prepend,options)},EventEmitter.prototype.many=function(event,ttl,fn,options){return this._many(event,ttl,fn,!1,options)},EventEmitter.prototype.prependMany=function(event,ttl,fn,options){return this._many(event,ttl,fn,!0,options)},EventEmitter.prototype._many=function(event,ttl,fn,prepend,options){function listener(){return 0==--ttl&&self.off(event,listener),fn.apply(this,arguments)}var self=this;if("function"!=typeof fn)throw new Error("many only accepts instances of Function");return listener._origin=fn,this._on(event,listener,prepend,options)},EventEmitter.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||init.call(this);var ns,args,l,i,j,containsSymbol,type=arguments[0],wildcard=this.wildcard;if("newListener"===type&&!this._newListener&&!this._events.newListener)return!1;if(wildcard&&(ns=type,"newListener"!==type&&"removeListener"!==type&&"object"==typeof type)){if(l=type.length,symbolsSupported)for(i=0;i<l;i++)if("symbol"==typeof type[i]){containsSymbol=!0;break}containsSymbol||(type=type.join(this.delimiter))}var handler,al=arguments.length;if(this._all&&this._all.length)for(handler=this._all.slice(),i=0,l=handler.length;i<l;i++)switch(this.event=type,al){case 1:handler[i].call(this,type);break;case 2:handler[i].call(this,type,arguments[1]);break;case 3:handler[i].call(this,type,arguments[1],arguments[2]);break;default:handler[i].apply(this,arguments)}if(wildcard)handler=[],searchListenerTree.call(this,handler,ns,this.listenerTree,0,l);else{if("function"==typeof(handler=this._events[type])){switch(this.event=type,al){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(args=new Array(al-1),j=1;j<al;j++)args[j-1]=arguments[j];handler.apply(this,args)}return!0}handler&&(handler=handler.slice())}if(handler&&handler.length){if(al>3)for(args=new Array(al-1),j=1;j<al;j++)args[j-1]=arguments[j];for(i=0,l=handler.length;i<l;i++)switch(this.event=type,al){case 1:handler[i].call(this);break;case 2:handler[i].call(this,arguments[1]);break;case 3:handler[i].call(this,arguments[1],arguments[2]);break;default:handler[i].apply(this,args)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===type)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},EventEmitter.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||init.call(this);var ns,containsSymbol,args,l,i,j,type=arguments[0],wildcard=this.wildcard;if("newListener"===type&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(wildcard&&(ns=type,"newListener"!==type&&"removeListener"!==type&&"object"==typeof type)){if(l=type.length,symbolsSupported)for(i=0;i<l;i++)if("symbol"==typeof type[i]){containsSymbol=!0;break}containsSymbol||(type=type.join(this.delimiter))}var handler,promises=[],al=arguments.length;if(this._all)for(i=0,l=this._all.length;i<l;i++)switch(this.event=type,al){case 1:promises.push(this._all[i].call(this,type));break;case 2:promises.push(this._all[i].call(this,type,arguments[1]));break;case 3:promises.push(this._all[i].call(this,type,arguments[1],arguments[2]));break;default:promises.push(this._all[i].apply(this,arguments))}if(wildcard?(handler=[],searchListenerTree.call(this,handler,ns,this.listenerTree,0)):handler=this._events[type],"function"==typeof handler)switch(this.event=type,al){case 1:promises.push(handler.call(this));break;case 2:promises.push(handler.call(this,arguments[1]));break;case 3:promises.push(handler.call(this,arguments[1],arguments[2]));break;default:for(args=new Array(al-1),j=1;j<al;j++)args[j-1]=arguments[j];promises.push(handler.apply(this,args))}else if(handler&&handler.length){if(handler=handler.slice(),al>3)for(args=new Array(al-1),j=1;j<al;j++)args[j-1]=arguments[j];for(i=0,l=handler.length;i<l;i++)switch(this.event=type,al){case 1:promises.push(handler[i].call(this));break;case 2:promises.push(handler[i].call(this,arguments[1]));break;case 3:promises.push(handler[i].call(this,arguments[1],arguments[2]));break;default:promises.push(handler[i].apply(this,args))}}else if(!this.ignoreErrors&&!this._all&&"error"===type)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(promises)},EventEmitter.prototype.on=function(type,listener,options){return this._on(type,listener,!1,options)},EventEmitter.prototype.prependListener=function(type,listener,options){return this._on(type,listener,!0,options)},EventEmitter.prototype.onAny=function(fn){return this._onAny(fn,!1)},EventEmitter.prototype.prependAny=function(fn){return this._onAny(fn,!0)},EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype._onAny=function(fn,prepend){if("function"!=typeof fn)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),prepend?this._all.unshift(fn):this._all.push(fn),this},EventEmitter.prototype._on=function(type,listener,prepend,options){if("function"==typeof type)return this._onAny(type,listener),this;if("function"!=typeof listener)throw new Error("on only accepts instances of Function");this._events||init.call(this);var temp,returnValue=this;return options!==undefined&&(temp=setupListener.call(this,type,listener,options),listener=temp[0],returnValue=temp[1]),this._newListener&&this.emit("newListener",type,listener),this.wildcard?(growListenerTree.call(this,type,listener,prepend),returnValue):(this._events[type]?("function"==typeof this._events[type]&&(this._events[type]=[this._events[type]]),prepend?this._events[type].unshift(listener):this._events[type].push(listener),!this._events[type].warned&&this._maxListeners>0&&this._events[type].length>this._maxListeners&&(this._events[type].warned=!0,logPossibleMemoryLeak.call(this,this._events[type].length,type))):this._events[type]=listener,returnValue)},EventEmitter.prototype.off=function(type,listener){if("function"!=typeof listener)throw new Error("removeListener only takes instances of Function");var handlers,leafs=[];if(this.wildcard){var ns="string"==typeof type?type.split(this.delimiter):type.slice();if(!(leafs=searchListenerTree.call(this,null,ns,this.listenerTree,0)))return this}else{if(!this._events[type])return this;handlers=this._events[type],leafs.push({_listeners:handlers})}for(var iLeaf=0;iLeaf<leafs.length;iLeaf++){var leaf=leafs[iLeaf];if(handlers=leaf._listeners,isArray(handlers)){for(var position=-1,i=0,length=handlers.length;i<length;i++)if(handlers[i]===listener||handlers[i].listener&&handlers[i].listener===listener||handlers[i]._origin&&handlers[i]._origin===listener){position=i;break}if(position<0)continue;return this.wildcard?leaf._listeners.splice(position,1):this._events[type].splice(position,1),0===handlers.length&&(this.wildcard?delete leaf._listeners:delete this._events[type]),this._removeListener&&this.emit("removeListener",type,listener),this}(handlers===listener||handlers.listener&&handlers.listener===listener||handlers._origin&&handlers._origin===listener)&&(this.wildcard?delete leaf._listeners:delete this._events[type],this._removeListener&&this.emit("removeListener",type,listener))}return this.listenerTree&&recursivelyGarbageCollect(this.listenerTree),this},EventEmitter.prototype.offAny=function(fn){var fns,i=0,l=0;if(fn&&this._all&&this._all.length>0){for(fns=this._all,i=0,l=fns.length;i<l;i++)if(fn===fns[i])return fns.splice(i,1),this._removeListener&&this.emit("removeListenerAny",fn),this}else{if(fns=this._all,this._removeListener)for(i=0,l=fns.length;i<l;i++)this.emit("removeListenerAny",fns[i]);this._all=[]}return this},EventEmitter.prototype.removeListener=EventEmitter.prototype.off,EventEmitter.prototype.removeAllListeners=function(type){if(type===undefined)return!this._events||init.call(this),this;if(this.wildcard){var leaf,i,leafs=searchListenerTree.call(this,null,type,this.listenerTree,0);if(!leafs)return this;for(i=0;i<leafs.length;i++)leaf=leafs[i],leaf._listeners=null;this.listenerTree&&recursivelyGarbageCollect(this.listenerTree)}else this._events&&(this._events[type]=null);return this},EventEmitter.prototype.listeners=function(type){var keys,listeners,allListeners,i,listenerTree,_events=this._events;if(type===undefined){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!_events)return[];for(keys=ownKeys(_events),i=keys.length,allListeners=[];i-- >0;)listeners=_events[keys[i]],"function"==typeof listeners?allListeners.push(listeners):allListeners.push.apply(allListeners,listeners);return allListeners}if(this.wildcard){if(!(listenerTree=this.listenerTree))return[];var handlers=[],ns="string"==typeof type?type.split(this.delimiter):type.slice();return searchListenerTree.call(this,handlers,ns,listenerTree,0),handlers}return _events?(listeners=_events[type],listeners?"function"==typeof listeners?[listeners]:listeners:[]):[]},EventEmitter.prototype.eventNames=function(nsAsArray){var _events=this._events;return this.wildcard?collectTreeEvents.call(this,this.listenerTree,[],null,nsAsArray):_events?ownKeys(_events):[]},EventEmitter.prototype.listenerCount=function(type){return this.listeners(type).length},EventEmitter.prototype.hasListeners=function(type){if(this.wildcard){var handlers=[],ns="string"==typeof type?type.split(this.delimiter):type.slice();return searchListenerTree.call(this,handlers,ns,this.listenerTree,0),handlers.length>0}var _events=this._events,_all=this._all;return!!(_all&&_all.length||_events&&(type===undefined?ownKeys(_events).length:_events[type]))},EventEmitter.prototype.listenersAny=function(){return this._all?this._all:[]},EventEmitter.prototype.waitFor=function(event,options){var self=this,type=typeof options;return"number"===type?options={timeout:options}:"function"===type&&(options={filter:options}),options=resolveOptions(options,{timeout:0,filter:undefined,handleError:!1,Promise:Promise,overload:!1},{filter:functionReducer,Promise:constructorReducer}),makeCancelablePromise(options.Promise,function(resolve,reject,onCancel){function listener(){var filter=options.filter;if(!filter||filter.apply(self,arguments))if(self.off(event,listener),options.handleError){var err=arguments[0];err?reject(err):resolve(toArray.apply(null,arguments).slice(1))}else resolve(toArray.apply(null,arguments))}onCancel(function(){self.off(event,listener)}),self._on(event,listener,!1)},{timeout:options.timeout,overload:options.overload})};var prototype=EventEmitter.prototype;if(Object.defineProperties(EventEmitter,{defaultMaxListeners:{get:function(){return prototype._maxListeners},set:function(n){if("number"!=typeof n||n<0||Number.isNaN(n))throw TypeError("n must be a non-negative number");prototype._maxListeners=n},enumerable:!0},once:{value:once,writable:!0,configurable:!0}}),Object.defineProperties(prototype,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),"function"==typeof define&&define.amd)define(function(){return EventEmitter});else if("object"==typeof exports)module.exports=EventEmitter;else{var _global="object"==typeof globalThis&&isGlobal(globalThis)&&globalThis||"object"==typeof window&&isGlobal(window)&&window||"object"==typeof global&&isGlobal(global)&&global||"object"==typeof self&&isGlobal(self)&&self||function(){return this}()||this||new Function("","return this")();_global.EventEmitter2=EventEmitter}}();